var GITHUB_ISSUES_LINK="https://api.github.com/repos/sorat0mo/url-short/issues/";var PATH_SEGMENTS_TO_SKIP=0;var OWNERS=["sorat0mo"];var USE_LABELS=true;var FALLBACK_TO_STATE_WHEN_NO_STATUS_LABELS=true;var DEFAULT_PASSTHROUGH="none";function isNumeric(num){return!isNaN(num)}function isUrl(url){return/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,24}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)+$/.test(url)}var isQuery=window.location.href.substr(-1)=="?";var keyword=window.location.pathname.split("/")[PATH_SEGMENTS_TO_SKIP+1];function renderSafeLink(containerId,url){const container=document.getElementById(containerId);container.textContent="";if(!isUrl(url)){container.textContent=url;return}const a=document.createElement("a");a.href=url;a.textContent=url;a.rel="noopener noreferrer";a.target="_blank";container.appendChild(a)}function labelsFrom(issue){var raw=(issue&&issue.labels)?issue.labels:[];var arr=[];for(var i=0;i<raw.length;i+=1){var name=raw[i]&&(raw[i].name||raw[i]);if(typeof name==="string"){arr.push(name)}}return arr}function parseLabelMap(labelList){var set=new Set();var map={};for(var i=0;i<labelList.length;i+=1){var l=String(labelList[i]).trim();if(!l){continue}var lower=l.toLowerCase();set.add(lower);var idx=lower.indexOf(":");if(idx>-1){var k=lower.slice(0,idx).trim();var v=lower.slice(idx+1).trim();if(k){map[k]=v}}}return{set:set,map:map}}function endOfDayUtc(dateStr){return new Date(dateStr+"T23:59:59.999Z")}function startOfDayUtc(dateStr){return new Date(dateStr+"T00:00:00.000Z")}function hasStatusLabels(labelSet,labelMap){return(labelSet.has("active")||labelSet.has("disabled")||labelSet.has("preview-only")||"start"in labelMap||"expires"in labelMap)}function buildRedirectUrl(baseUrl,passthroughMode){var finalUrl=baseUrl;var search=window.location.search||"";var hash=window.location.hash||"";if(passthroughMode==="query"||passthroughMode==="all"){if(search){if(finalUrl.indexOf("?")===-1){finalUrl+=search}else{finalUrl+=search.replace(/^\?/,"&")}}}if(passthroughMode==="all"&&hash){finalUrl+=hash}return finalUrl}function evaluateIssue(issue){if(!issue||!issue.user||OWNERS.indexOf(issue.user.login)===-1){return{ok:false,message:"Failed authentication (GitHub Issue not created by allowed owner)",url:"",previewOnly:false}}var labels=labelsFrom(issue);var parsed=parseLabelMap(labels);var labelSet=parsed.set;var labelMap=parsed.map;var useStateFallback=FALLBACK_TO_STATE_WHEN_NO_STATUS_LABELS&&!hasStatusLabels(labelSet,labelMap);if(USE_LABELS&&!useStateFallback){if(labelSet.has("disabled")){return{ok:false,message:"Link disabled by label.",url:"",previewOnly:false}}var now=new Date();if("start"in labelMap){var start=startOfDayUtc(labelMap.start);if(!isNaN(start)&&now<start){return{ok:false,message:"Link not active until "+labelMap.start+" (UTC).",url:"",previewOnly:false}}}if("expires"in labelMap){var exp=endOfDayUtc(labelMap.expires);if(!isNaN(exp)&&now>exp){return{ok:false,message:"Link expired on "+labelMap.expires+" (UTC).",url:"",previewOnly:false}}}if(!labelSet.has("active")){return{ok:false,message:"Link not active (missing 'active' label).",url:"",previewOnly:false}}var passthrough=labelMap.passthrough||DEFAULT_PASSTHROUGH;var previewOnly=labelSet.has("preview-only");var targetUrl=issue.title;var finalUrl=buildRedirectUrl(targetUrl,passthrough);return{ok:true,message:"",url:finalUrl,previewOnly:previewOnly}}else{if(issue.state!=="closed"){return{ok:false,message:"Issue not closed, not redirecting.",url:"",previewOnly:false}}var passthroughLegacy=DEFAULT_PASSTHROUGH;var targetUrlLegacy=issue.title;var finalUrlLegacy=buildRedirectUrl(targetUrlLegacy,passthroughLegacy);return{ok:true,message:"",url:finalUrlLegacy,previewOnly:false}}}var xhr=new XMLHttpRequest();xhr.onload=function(){var issue="";var url="";if(isNumeric(keyword)){if(xhr.status==200){var payload={};try{payload=JSON.parse(xhr.response)}catch(e){}issue=payload}else{issue=""}}else{var listPayload=[];try{listPayload=JSON.parse(xhr.response)}catch(e){}for(var i=0;i<listPayload.length;i+=1){if(listPayload[i].body==keyword){issue=listPayload[i];break}}}if(issue!=""){var evalResult=evaluateIssue(issue);if(evalResult.ok){url=evalResult.url;var effectivePreview=isQuery||evalResult.previewOnly;renderSafeLink("link",url);if(isUrl(url)&&!effectivePreview){window.location.replace(url)}if(isUrl(url)){var qr=new QRious({element:document.getElementById('qrcode'),value:url,size:200})}return}else{url=evalResult.message||"Link not available."}}else{url="Slug or issue not found."}renderSafeLink("link",url);if(isUrl(url)){var qr2=new QRious({element:document.getElementById('qrcode'),value:url,size:200})}};var api_url=GITHUB_ISSUES_LINK;if(isNumeric(keyword)){api_url+=keyword}else{api_url=api_url.slice(0,-1)+"?state=all&per_page=100"}xhr.open("GET",api_url);xhr.send();</script> ;
